!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var s=e();for(var i in s)("object"==typeof exports?exports:t)[i]=s[i]}}(window,(function(){return function(t){var e={};function s(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,s),o.l=!0,o.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(i,o,function(e){return t[e]}.bind(null,o));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e),s.d(e,"Minefield",(function(){return i})),s.d(e,"Bot",(function(){return n}));var i={};s.r(i),s.d(i,"getInstance",(function(){return M})),s.d(i,"CHECKERS",(function(){return v})),s.d(i,"DEFAULTS",(function(){return L})),s.d(i,"EVENTS",(function(){return A})),s.d(i,"STATUS",(function(){return N})),s.d(i,"default",(function(){return S}));var o={};s.r(o),s.d(o,"BoardMap",(function(){return T})),s.d(o,"CalculateNext",(function(){return x}));var n={};s.r(n),s.d(n,"getInstance",(function(){return P})),s.d(n,"SPEED",(function(){return R})),s.d(n,"PROCESS",(function(){return k})),s.d(n,"default",(function(){return F}));const a={debug:!1},r=t=>({cols:t,rows:t,mines:t}),h={EASY:{...a,...r(10)},MEDIUM:{...a,...r(15)},HARD:{...a,...r(30),mines:100}},u={ALL:"all",START:"start",NEXT_TURN:"nextTurn",FINISH:"finish"},c={LOSS:"LOSS",PLAYING:"PLAYING",WIN:"WIN"},d={EMPTY:"",FLAG:"F",MINE:-1,NUMBER_0:0,NUMBER_1:1,NUMBER_2:2,NUMBER_3:3,NUMBER_4:4,NUMBER_5:5,NUMBER_6:6,NUMBER_7:7,NUMBER_8:8};var l=class{constructor(){this.observer=[]}on(t,e){return this.addEvent(t),this.observer[t].push(e),this}emit(t,e){this.addEvent(t),this.observer[t].forEach(t=>t(e))}addEvent(t){void 0===this.observer[t]&&(this.observer[t]=[])}};var p={updateValue:function(t,e,s){this.state.setValue(t,e,s),this.state.get("updated").push({row:t,col:e,value:s}),-1===[d.EMPTY,d.FLAG,d.MINE].indexOf(s)&&this.state.set("checked",this.state.get("checked")+1)},openAll:function(){const t=this.state.get("board");t.map((e,s)=>e.map((e,i)=>{t[s][i]=this.board[s][i]})),this.state.set("board",t)},open:function(t,e,s=!1){if(!this.state.isFinish()){if(s||this.state.set("updated",[]),this.state.getValue(t,e)===d.EMPTY){const s=this.board[t][e];this.updateValue(t,e,s),0===s&&this.expand(t,e)}s||this.nextTurn()}},flag:function(t,e,s=!1){if(this.state.isFinish())return;s||this.state.set("updated",[]);const i=this.state.getValue(t,e);[d.FLAG,d.EMPTY].indexOf(i)>-1&&this.updateValue(t,e,i===d.FLAG?d.EMPTY:d.FLAG),s||this.nextTurn()},batch:function(t){this.state.set("updated",[]),t.forEach(t=>{this[t.type===d.FLAG?"flag":"open"](t.row,t.col,!0)}),this.nextTurn()},expand:function(t,e){for(let s=t-1;s<=t+1;s++)for(let t=e-1;t<=e+1;t++)void 0!==this.board[s]&&void 0!==this.board[s][t]&&this.board[s][t]>=d.NUMBER_0&&this.board[s][t]<=d.NUMBER_8&&this.state.get("board")[s][t]===d.EMPTY&&(this.updateValue(s,t,this.board[s][t]),this.board[s][t]===d.NUMBER_0&&this.expand(s,t))}};class f{constructor(t){this.options=t}make(){return this.options.mock?(this.data=JSON.parse(this.options.mock),this.options.rows=this.data.length,this.options.cols=this.data[0].length,this.options.mines=this.options.mock.match(/-1/g).length):(this.makeBoard(),this.makeMines()),this.data}makeBoard(){this.data=Array(this.options.rows).fill(null).map(()=>Array(this.options.cols).fill(null).map(()=>0))}makeMines(){let t=0,e="";do{const s=this.getRandomMap(),i=s.join(",")+"|";-1===e.indexOf(i)&&(this.data[s[0]][s[1]]=d.MINE,this.fillAround(s),e+=i,t++)}while(t<this.options.mines)}fillAround(t){for(let e=t[0]-1;e<=t[0]+1;e++)for(let s=t[1]-1;s<=t[1]+1;s++)void 0!==this.data[e]&&void 0!==this.data[e][s]&&this.data[e][s]>d.MINE&&this.data[e][s]++}getRandomMap(){const t=t=>Math.floor(Math.random()*t);return[t(this.options.rows),t(this.options.cols)]}}f.make=t=>new f(t).make();var b=f;var E=class{constructor(t,e){this.options=t,this.board=e,this.init()}init(){this.state={rows:this.options.rows,cols:this.options.cols,mines:this.options.mines,total:this.options.cols*this.options.rows-this.options.mines,status:c.PLAYING,checked:0,updated:[],board:Array(this.options.rows).fill(null).map(()=>Array(this.options.cols).fill(null).map(()=>""))}}get(t){return t?this.state[t]:this.state}set(t,e){this.state[t]=e}getValue(t,e){return this.state.board[t][e]}setValue(t,e,s){this.state.board[t][e]=s}isWin(){return this.get("status")===c.WIN}isLoss(){return this.get("status")===c.LOSS}isFinish(){return this.isWin()||this.isLoss()}};class g{constructor(t){this.options={...t},this.observer=new l}addListener(t,e){this.observer.on(t,e)}emit(t){this.observer.emit(t,this.getState()),this.observer.emit(u.ALL,{event:t,state:this.getState()})}start(){return this.board=b.make(this.options),this.state=new E(this.options,this.board),this.emit(u.START),this}getState(){const t=this.state.get();return this.options.debug&&(t.debug={board:this.board}),t}nextTurn(){switch(this.updateStatus(),this.state.get("status")){case c.PLAYING:this.emit(u.NEXT_TURN);break;case c.LOSS:case c.WIN:this.openAll(),this.emit(u.FINISH)}}updateStatus(){0!==this.state.get("updated").length&&this.state.set("status",this.state.get("updated")[0].value===d.MINE?c.LOSS:this.state.get("checked")===this.state.get("total")?c.WIN:c.PLAYING)}}Object.keys(p).forEach(t=>{g.prototype[t]=p[t]});var m=g;function M(t=h.MEDIUM){const e=new m(t),s={addListener:(t,i)=>(e.addListener(t,i),s),start:()=>e.start(),open:(t,s)=>e.open(t,s),flag:(t,s)=>e.flag(t,s),batch:t=>e.batch(t),getState:()=>e.getState(),reset:()=>e.start()};return s}const v=d,L=h,A=u,N=c;var S={getInstance:M},T={makeBoardMap:function(){this.boardMap={},Object.keys(v).forEach(t=>{this.boardMap[v[t]]=[]}),this.state.board.forEach((t,e)=>t.forEach((t,s)=>this.addMap(e,s,t)))},addMap:function(t,e,s){const i={row:t,col:e,value:s,around:{}};this.calcAround(i),this.boardMap[s].push(i)},calcAround:function(t){const e={out:0};Object.keys(v).map(t=>{e[v[t]]=[]});const{rows:s,cols:i}=this.state;0===t.row&&(0===t.col||t.col===i-1)||t.row===s-1&&(0===t.col||t.col===i-1)?e.out+=5:0!==t.row&&t.row!==s-1&&0!==t.col&&t.col!==i-1||(e.out+=3);for(let s=t.row-1;s<=t.row+1;s++)for(let i=t.col-1;i<=t.col+1;i++)void 0!==this.state.board[s]&&void 0!==this.state.board[s][i]&&e[this.state.board[s][i]].push({row:s,col:i});t.around=e}},x={calculateNextList:function(){this.addAvailableFlag(),this.addAvailableOpen(),this.addRandOpen(),this.removeDuplication()},addAvailableFlag:function(){Object.keys(v).filter(t=>![v.EMPTY,v.FLAG].includes(v[t])).forEach(t=>{this.boardMap[v[t]].forEach(t=>{if(t.value===t.around[v.EMPTY].length+t.around[v.FLAG].length){const e=t.around[v.EMPTY];e.forEach(t=>{t.type=v.FLAG}),this.nextList=[...this.nextList,...e]}})})},addAvailableOpen:function(){Object.keys(v).filter(t=>![v.EMPTY,v.FLAG].includes(v[t])).forEach(t=>{this.boardMap[v[t]].forEach(t=>{if(t.value===t.around[v.FLAG].length){const e=t.around[v.EMPTY];e.forEach(t=>{t.origin="ADD_OPEN"}),this.nextList=[...this.nextList,...e]}})})},addRandOpen:function(){if(0===this.state.checked||0===this.nextList.length){const t=t=>Math.floor(Math.random()*t),e=this.boardMap[v.EMPTY],s={origin:"RANDOM",...e[t(e.length)]};this.nextList.push(s)}},removeDuplication:function(){this.nextList=this.nextList.filter((t,e)=>{for(let s=e+1;s<this.nextList.length;s++)if(t.row===this.nextList[s].row&&t.col===this.nextList[s].col)return!1;return!0})}};const y={NONE:-1,FAST:1e3,NORMAL:2e3,SLOW:4e3},O={BATCH:"batch",UNIT:"unit"};class w{constructor(t){Object.keys(t).forEach(e=>{this[e]=t[e]}),this.speed!==y.NONE&&this.game.addListener(A.ALL,t=>{this.autoRun(t)},this.speed),this.observer=new l,this.reset()}onFinish(t){this.observer.on("onFinish",t)}reset(){this.nextList=[],this.stoped=!1}autoRun(t){t.event===A.START&&this.reset(),this.stoped||(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.run(),this.speed))}play(){return this.stoped=!1,this.run(),this}stop(){this.stoped=!0}run(){this.setState(),this.state.status===N.PLAYING&&(this.calculate(),this.open()),this.result()}calculate(){this.nextList.length>0||(this.makeBoardMap(),this.calculateNextList())}result(){this.state.status!==N.PLAYING&&this.observer.emit("onFinish",this.state.status)}open(){const t=this.process===O.BATCH?[].concat(this.nextList):[this.nextList.pop()];this.process===O.BATCH&&(this.nextList=[]),this.game.batch(t)}setState(){this.state=this.game.getState()}}Object.keys(o).forEach(t=>{Object.keys(o[t]).forEach(e=>{w.prototype[e]=o[t][e]})});var I=w;function P(t){const e=new I(t);return{play:()=>e.play(),stop:()=>e.stop(),setSpeed:t=>{e.speed=t},setProcess:t=>{e.process=t},onFinish:t=>{e.onFinish(t)}}}const R=y,k=O;var F={getInstance:P}}])}));
//# sourceMappingURL=minefield.min.js.map